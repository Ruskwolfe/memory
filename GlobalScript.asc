// main global script file

function defaultactions1()
{
   if (cEgo.ActiveInventory == iwaterskin)
  {
    cEgo.Say("I cant fill the waterskin with that.");
  }

  else if (cEgo.ActiveInventory == iKey)
  {
    cEgo.Say("Yeah, the wont benefit from being cut.");
  }

  else if (cEgo.ActiveInventory == iwaterskinnfull)
  {
    cEgo.Say("I should conserve my drinking water.");
  }
    else if (cEgo.ActiveInventory == iBlackPowder)
  {
    cEgo.Say("Smearing this with black powder will do nobody any good.");
  }
    else if (cEgo.ActiveInventory == iBlackPowder)
  {
    cEgo.Say("Smearing this with black powder will do nobody any good.");
  }
    else if (cEgo.ActiveInventory == iShrooms1)
  {
    cEgo.Say("That does not need fungi");
  }
    else if (cEgo.ActiveInventory == iBucket)
  {
    cEgo.Say("Slam a bucket against it, why ?");
  }
    else if (cEgo.ActiveInventory == iBucketwater)
  {
    cEgo.Say("Why would I throw water on this ?");
  }
      else if (cEgo.ActiveInventory == iBlueCup)
  {
    cEgo.Say("I doubt my access card gives me access here.");
  }
      else if (cEgo.ActiveInventory == iComputer)
  {
    cEgo.Say("Not everything can be solved with computers.");
  }
      else if (cEgo.ActiveInventory == ODrill)
  {
    cEgo.Say("Well drilling this might be fun, I don't think it is useful.");
  }
      else if (cEgo.ActiveInventory == iWires)
  {
    cEgo.Say("That looks wired enough as it is.");
  }
      else if (cEgo.ActiveInventory == iComputerwire)
  {
    cEgo.Say("I cant see a port to connect it.");
  }
      else if (cEgo.ActiveInventory == iBlast)
  {
    cEgo.Say("That probably has enough energy in it.");
  }
      else if (cEgo.ActiveInventory == iFood)
  {
    cEgo.Say("I somehow doubt that would make the food more edible.");
  }
      else if (cEgo.ActiveInventory == iWrecker)
  {
    cEgo.Say("I need to wreck other stuff, not this.");
  }
}

// A function that initializes a bunch of stuff.
function initialize_control_panel() { 
  // Centre the UI panels
  gPanel.Centre(); 
  gRestartYN.Centre();
  gExitGame.Centre();
  gSaveGame.Centre();
  gRestoreGame.Centre();

  if (!IsSpeechVoxAvailable()) { 
    // If there is no speech-vox file, and therefore no speech,
    // disable all the controls related with speech.
    lblVoice.Visible = false;  
    btnVoice.Visible = false;  
    sldVoice.Visible = false;
  }
  else {
    // If there *is*, then set it to voice and text. It's best to use
    // both whenever possible, for the player's sake.
    Speech.VoiceMode = eSpeechVoiceAndText;
    // And reflect this in the control panel.
    btnVoice.Text = "Voice and Text"; 
  }
  if (!System.SupportsGammaControl) {
    // If we can't change the gamma settings, disable the relevant options.
    sldGamma.Visible = false; 
    lblGamma.Visible = false;
  } 
  
  //And now, set all the defaults
  System.Volume = 100;
  sldAudio.Value = System.Volume;
  SetGameSpeed(40);
  sldSpeed.Value = 40;
  if (IsSpeechVoxAvailable()) {
     Speech.VoiceMode = eSpeechVoiceAndText;
     btnVoice.Text = "Voice and Text";
     sldVoice.Value = 255;
     SetSpeechVolume(255);
  }
  if (System.SupportsGammaControl) {
    System.Gamma = 100;
    sldGamma.Value = 100;
  }
}

// Called when the game starts, before the first room is loaded
function game_start() {   
  // Put the code all in a function and then just call the function. 
  // It saves cluttering up places like game_start.
  initialize_control_panel(); 
  // Use the KeyboardMovement module to, per default, replicate the standard
  // keyboard movement of most Sierra games. See KeyboardMovement.txt for more info
  KeyboardMovement.SetMode(eKeyboardMovement_Tapping); 
}

function repeatedly_execute() {
  
  // Put here anything you want to happen every game cycle, even when
  // the game is paused. This will not run when the game is blocked
  // inside a command like a blocking Walk()
  
  if (IsGamePaused() == 1) return;

  // Put here anything you want to happen every game cycle, but not
  // when the game is paused.
}

function repeatedly_execute_always() {
  
  // Put anything you want to happen every game cycle, even
  // when the game is blocked inside a command like a
  // blocking Walk().
  // You cannot run blocking commands from this function.
  
}

function show_inventory_window () 
{
  gIconbar.Visible = false;
  gInventory.Visible = true;
  // switch to the Use cursor (to select items with)
  mouse.Mode = eModeInteract;
  // But, override the appearance to look like the arrow
  mouse.UseModeGraphic(eModePointer);
}

function show_save_game_dialog()
{
  gSaveGame.Visible = true;
  // Get the list of save games
  lstSaveGamesList.FillSaveGameList();
  if (lstSaveGamesList.ItemCount > 0)
  {
    // If there is at least one, set the default text
    // to be the first game's name
    txtNewSaveName.Text = lstSaveGamesList.Items[0];
  }
  else
  {
    // No save games yet, default empty text.
    txtNewSaveName.Text = "";
  }
  mouse.UseModeGraphic(eModePointer);
  gIconbar.Visible = false;
}

function show_restore_game_dialog()
{
  gRestoreGame.Visible = true;
  lstRestoreGamesList.FillSaveGameList();
  mouse.UseModeGraphic(eModePointer);
  gIconbar.Visible = false;
}

function close_save_game_dialog()
{
  gSaveGame.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
}

function close_restore_game_dialog()
{
  gRestoreGame.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
}

function show_exit_dialog() {
  gExitGame.Visible = true;
  gIconbar.Visible = false;
  mouse.UseModeGraphic(eModePointer);  
}

// Called when a key is pressed. keycode holds the key's ASCII code
function on_key_press(eKeyCode keycode) {
  // The following is called before "if game is paused keycode=0", so
  // it'll happen even when the game is paused.
  
  if ((keycode == eKeyEscape) && gRestartYN.Visible) {
    //Use ESC to cancel restart.
    gRestartYN.Visible = false; 
    gIconbar.Visible = true;
    // If the panel's not ON, then the player must have gotten here by tapping F9,
    // therefore his cursor needs restoring. If the panel IS on, then it doesn't,
    // because it's already a pointer. Get used to thinking like this!!
    if (!gPanel.Visible) mouse.UseDefaultGraphic(); 
    return;
  }
  if ((keycode == eKeyEscape) && gPanel.Visible) {
    // Use ESC to turn the panel off.
    gPanel.Visible = false; 
    mouse.UseDefaultGraphic();
    gIconbar.Visible = true;
    return;
  }
  if ((keycode == eKeyEscape) && (gSaveGame.Visible))
  {
    // Use ESC to close the save game dialog
    close_save_game_dialog();
    return;
  }
  if ((keycode == eKeyEscape) && (gRestoreGame.Visible))
  {
    // Use ESC to close the restore game dialog
    close_restore_game_dialog();
    return;
  }
  
  if (keycode == eKeyReturn) { 
    // ENTER, in this case merely confirms restart
    if (gRestartYN.Visible) RestartGame();
  }

  if (IsGamePaused() || (IsInterfaceEnabled() == 0))
  {
    // If the game is paused with a modal GUI on the
    // screen, or the player interface is disabled in
    // a cut scene, ignore any keypresses.
    return;
  }

  // FUNCTION KEYS AND SYSTEM SHORTCUTS
  if (keycode == eKeyEscape) {
    // ESC
    gPanel.Visible = true; 
    gIconbar.Visible = false;
    mouse.UseModeGraphic(eModePointer);
  }
  if (keycode == eKeyCtrlQ) show_exit_dialog();   // Ctrl-Q
  if (keycode == eKeyF5) show_save_game_dialog();   // F5
  if (keycode == eKeyF7) show_restore_game_dialog();  // F7
  if (keycode == eKeyF9) {
    // F9, asks the player to confirm restarting (so much better to always confirm first)
    gRestartYN.Visible = true;  
    gIconbar.Visible = false;
    mouse.UseModeGraphic(eModePointer);
  }
  if (keycode == eKeyF12) SaveScreenShot("scrnshot.bmp");  // F12
  if (keycode == eKeyTab)   show_inventory_window();  // Tab, show inventory

  // GAME COMMAND SHORTCUTS
  if (keycode == 'W') mouse.Mode=eModeWalkto; //Notice this alternate way to indicate keycodes.
  if (keycode == 'L') mouse.Mode=eModeLookat; //Note that all we do here is set modes.
  if (keycode == 'U') mouse.Mode=eModeInteract; //If you want something else to happen, such as GUI buttons highlighting,
  if (keycode == 'T') mouse.Mode=eModeTalkto; //you'll need some more scripting done.
  if (keycode == 'I') mouse.Mode=eModeUseinv; //But this will, as-is, give you some standard keyboard shortcuts your players will very much appreciate.

  // For extra cursor modes, such as pick up, feel free to add as you will.
  // Uncomment the line below if you use the "Pick Up" mode.
  //if (keycode == 'P' || keycode == 'G') mouse.Mode=eModePickup; 

  // DEBUG FUNCTIONS
  if (keycode == eKeyCtrlS)  Debug(0,0);  // Ctrl-S, give all inventory
  if (keycode == eKeyCtrlV)  Debug(1,0);  // Ctrl-V, version
  if (keycode == eKeyCtrlA)  Debug(2,0);  // Ctrl-A, show walkable areas
  if (keycode == eKeyCtrlX)  Debug(3,0);  // Ctrl-X, teleport to room
  if (keycode == eKeyCtrlW && game.debug_mode) 
    player.PlaceOnWalkableArea(); //Ctrl-W, move to walkable area 
}


function on_mouse_click(MouseButton button) {
  // called when a mouse button is clicked. button is either LEFT or RIGHT
  if (IsGamePaused() == 1) {
    // Game is paused, so do nothing (ie. don't allow mouse click)
  }
  else if (button == eMouseLeft) {
    Room.ProcessClick(mouse.x, mouse.y, mouse.Mode );
  }
  else if (button == eMouseRight || button == eMouseWheelSouth){
    // right-click our mouse-wheel down, so cycle cursor
    mouse.SelectNextMode();
  }
  else if (button == eMouseMiddle) { 
    // Middle-button-click, default make character walk to clicked area (a little shortcut)
    // Could have been just "player.Walk(mouse.x,mouse.y)", but it's best to
    // leave our options open - what if you have a special script triggered
    // on "walking" mode?
    Room.ProcessClick(mouse.x, mouse.y, eModeWalkto); 
  }
  else if (button == eMouseWheelNorth) { 
    // Mouse-wheel up, cycle cursors 
    // If mode isn't WALK, set the previous mode (notice usage of numbers instead
    // of eNums, when it suits us)...
    if (mouse.Mode>0) mouse.Mode=mouse.Mode-1; 
    else 
    { 
      // ...but if it is WALK mode...
      if (player.ActiveInventory!=null) 
      {
        //...and the player has a selected inventory item, set mouse mode to UseInv. 
        mouse.Mode=eModeUseinv; 
      }
      else 
      {
        // If they don't, however, just set it to mode TALK (change this line if you add more cursor modes)
        mouse.Mode=eModeTalkto; 
      }
    }
  }
}

function interface_click(int interface, int button) {
  // This function is obsolete, from 2.62 and earlier versions.
}

function btnInvUp_Click(GUIControl *control, MouseButton button) {
  invCustomInv.ScrollUp();
}

function btnInvDown_Click(GUIControl *control, MouseButton button) {
  invCustomInv.ScrollDown();
}

function btnInvOK_Click(GUIControl *control, MouseButton button) {
	// They pressed the OK button, close the GUI
	gInventory.Visible = false;
  gIconbar.Visible = true;
	mouse.UseDefaultGraphic();
}

function btnTutorial_Click(GUIControl *control, MouseButton button)
{Display("Well now we're cooking with Gas");
}
function btnInvSelect_Click(GUIControl *control, MouseButton button) {
  
	// They pressed SELECT, so switch to the Get cursor
	mouse.Mode = eModeInteract;
	// But, override the appearance to look like the arrow
	mouse.UseModeGraphic(eModePointer);
}

function btnIconInv_Click(GUIControl *control, MouseButton button) {
  
  show_inventory_window();
}

function btnIconCurInv_Click(GUIControl *control, MouseButton button) {
  
  if (player.ActiveInventory != null)
    mouse.Mode = eModeUseinv;
}

function btnIconSave_Click(GUIControl *control, MouseButton button) 
{
  show_save_game_dialog();
}

function btnIconLoad_Click(GUIControl *control, MouseButton button) 
{
  show_restore_game_dialog();
}

function btnIconExit_Click(GUIControl *control, MouseButton button) {
  show_exit_dialog();
}

function btnIconAbout_Click(GUIControl *control, MouseButton button) {
  
  gPanel.Visible=true;
  gIconbar.Visible=false;
  mouse.UseModeGraphic(eModePointer);
}

function cEgo_Look()
{
  cEgo.Say("Damn, I'm looking good!");
}

function cEgo_Interact()
{
  Display("You rub your hands up and down your clothes.");
}

function cEgo_Talk()
{
  Display("Talking to yourself is a sign of madness!");
}

//START OF CONTROL PANEL FUNCTIONS
function btnSave_OnClick(GUIControl *control, MouseButton button)
{
  gPanel.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
  Wait(1);
  btnIconSave_Click(btnIconSave, eMouseLeft);
}

function gControl_OnClick(GUI *theGui, MouseButton button)
{

}

function btnAbout_OnClick(GUIControl *control, MouseButton button)
{
Display("Adventure Game Studio run-time engine default game.");
}

function btnQuit_OnClick(GUIControl *control, MouseButton button)
{
  gPanel.Visible = false;
  show_exit_dialog();
  QuitGame(0);
}

function btnLoad_OnClick(GUIControl *control, MouseButton button)
{
  gPanel.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
  Wait(1);
  btnIconLoad_Click(btnIconLoad, eMouseLeft);
}

function bPlay_OnClick(GUIControl *control, MouseButton button)
{
    gPanel.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
  gExitGame.Visible = false;
  Wait(1);
}

function btnResume_OnClick(GUIControl *control, MouseButton button)
{
  gPanel.Visible = false;
  mouse.UseDefaultGraphic();
  gIconbar.Visible = true;
}

function sldAudio_OnChange(GUIControl *control)
{
  System.Volume = sldAudio.Value;
}

function sldVoice_OnChange(GUIControl *control)
{
  // Sets voice volume. Note that we don't check for the existence of speech.vox - 
  // we did that in game_start, so if it's not there the slider won't even be available.
  SetSpeechVolume(sldVoice.Value); 
}

function btnVoice_OnClick(GUIControl *control, MouseButton button)
{
  // Note that we don't check for the existence of speech.vox - we did that in game_start,
  // so if it's not there the button won't even be available.
  if (btnVoice.Text == "Voice and Text") { 
    Speech.VoiceMode = eSpeechVoiceOnly;
    btnVoice.Text = "Voice only";
  }
  else if (btnVoice.Text == "Voice only") {
    Speech.VoiceMode = eSpeechTextOnly;
    btnVoice.Text = "Text only";
  }
  else if (btnVoice.Text == "Text only") {
    Speech.VoiceMode = eSpeechVoiceAndText;
    btnVoice.Text = "Voice and Text";
  }
}

function sldGamma_OnChange(GUIControl *control)
{
  // Set the gamma. Note there's no need to check for anything else, as we ensured,
  // in game_start, that the slider won't even appear if it's not possible to do this.
  System.Gamma = sldGamma.Value; 
}

function btnDefault_OnClick(GUIControl *control, MouseButton button)
{
  // Reset everything to default. You'll have to edit these as well as the sliders
  // if you'd rather have different default parameters.
  System.Volume = 100;
  sldAudio.Value = System.Volume;
  sldSpeed.Value = 40;
  SetGameSpeed(40);
  if (IsSpeechVoxAvailable()) {
     Speech.VoiceMode = eSpeechVoiceAndText;
     btnVoice.Text = "Voice and Text";
     sldVoice.Value = 255;
     SetSpeechVolume(255);
  }
  if (System.SupportsGammaControl) {
    System.Gamma = 100;
    sldGamma.Value = 100;
  }
}
//END OF CONTROL PANEL FUNCTIONS

function dialog_request(int param) 
{
  // This is used by the dialog text parser if you need to process
  // text that the player types in to the parser.
  // It is not used by default.
}

function sldSpeed_OnChange(GUIControl *control)
{
  SetGameSpeed(sldSpeed.Value);
}

function btnRestart_OnClick(GUIControl *control, MouseButton button)
{
  gPanel.Visible = false;
  gRestartYN.Visible = true;
  gIconbar.Visible = false;
}

function btnRestartYes_OnClick(GUIControl *control, MouseButton button)
{
  RestartGame();
}

function btnRestartNo_OnClick(GUIControl *control, MouseButton button)
{
  gRestartYN.Visible = false;
  gIconbar.Visible = true;
  // If the panel's not ON, then the player must have gotten here by tapping F9,
  // therefore his cursor needs restoring. If the panel IS on, then it doesn't,
  // because it's already a pointer. Get used to thinking like this!!
  if (!gPanel.Visible) mouse.UseDefaultGraphic(); 
}

function btnCancelSave_OnClick(GUIControl *control, MouseButton button)
{
  close_save_game_dialog();
}

int find_save_slot(String name)
{
  bool slots[] = new bool[999];
  int i = 0;
  while (i < lstSaveGamesList.ItemCount)
  {
    if (lstSaveGamesList.Items[i] == name)
    {
      // found existing save with matching name
      return lstSaveGamesList.SaveGameSlots[i];
    }
    // remember which slots are already taken
    slots[lstSaveGamesList.SaveGameSlots[i]] = true;
    i++;
  }
 
  // Find first free save slot, starting with slot 1
  i = 1;
  while (i < 999)
  {
    if (!slots[i])
      return i;
    i++;
  }
  // no free slots found
  return -1;
}
 
function btnSaveGame_OnClick(GUIControl *control, MouseButton button)
{
  int gameSlotToSaveInto = find_save_slot(txtNewSaveName.Text);
  if (gameSlotToSaveInto < 0)
  {
    Display("No more free save slots!");
    return;
  }
  SaveGameSlot(gameSlotToSaveInto, txtNewSaveName.Text);
  close_save_game_dialog();
}

function btnCancelRestore_OnClick(GUIControl *control, MouseButton button)
{
  close_restore_game_dialog();
}

function btnRestoreGame_OnClick(GUIControl *control, MouseButton button)
{
  if (lstRestoreGamesList.SelectedIndex >= 0)
  {
    RestoreGameSlot(lstRestoreGamesList.SaveGameSlots[lstRestoreGamesList.SelectedIndex]);
  }
  close_restore_game_dialog();
}

function lstSaveGamesList_OnSelectionCh(GUIControl *control)
{
  txtNewSaveName.Text = lstSaveGamesList.Items[lstSaveGamesList.SelectedIndex];
}

function txtNewSaveName_OnActivate(GUIControl *control)
{
  // Pressing return in the text box simulates clicking the Save button
  btnSaveGame_OnClick(control, eMouseLeft);
}

function btnDeleteSave_OnClick(GUIControl *control, MouseButton button)
{
  if (lstSaveGamesList.SelectedIndex >= 0)
  {
    DeleteSaveSlot(lstSaveGamesList.SaveGameSlots[lstSaveGamesList.SelectedIndex]);
    lstSaveGamesList.FillSaveGameList();
  }
}


function iKey_Look()
{
Display ("The Recto XF SJS SE+");
Display ("This baby can slice through your wrist in a matter of seconds");
Display ("Which is what most of you citydwellers do with this after all");
}

function iwaterskinnfull_Look()
{
Display("The filtered waterskin is full of fresh dihydrogenmonoxcyde");
}

function iBlackPowder_Look()
{
Display("This smells awful, it is not gunpowder at least");
}

function cair_Look()
{
Display("Man, it is still burning, better get that water to put the fire out");
}

function iBucketwater_Look()
{
Display("It is a bucket full of water, like why do you need this explained to you ?");
}

function iBucket_Look()
{
Display("If you do not know what a bucket is, why the hell are you playing adventure games ?");
}

function cFisherman_Interact()
{
cEgo.FaceCharacter(cFisherman);
cEgo.Say("I am not touching that, who know where it's been !");
}

function cFisherman_Look()
{
  cEgo.FaceCharacter(cFisherman);
cEgo.Say("A... a Fisherman !? But I'm suppose to be alone on this planet !?");
}

function cFisherman_Talk()
{
  cEgo.FaceCharacter(cFisherman);
  cFisherman.FaceCharacter(cEgo);
  fishtalk1 = 1;
dFish1.Start();
}



//	if (player.InventoryQuantity[iMoney.ID]==1) Display("You have 1 coin");
//else Display("You have %d coins.", player.InventoryQuantity[iMoney.ID]);


function btnTutorial_OnClick(GUIControl *control, MouseButton button)
{
Display("Are you for real ?");
tutorial=1;
gTutorial.Visible = false;
}


function gInventory_OnClick(GUI *theGui, MouseButton button)
{

}

function iwaterskin_Look()
{
Display("The Kamashitech Waterskin™");
Display("Will stretch as much as a pregnant woman in yogapants.");
}

function iShrooms1_Look()
{
cEgo.Say("Hmmmm, I should really be careful with these.");
}



function unhandled_event(int what, int type) {

   //  Unhandled Hotspot
   if (what == 1) {         // Hotspot     
      if (type==1) {         // 1    1   Look at hotspot
      }
      else if (type==2) {  //  1    2   Interact with hotspot
      Display ("Well yeah, that's a thing.");
      }
      else if (type==3) {  //  1    3   Use inventory on hotspot
      Display ("That is probably a brilliant idea, but it is not the right idea.");
      }
      else if (type==4) {  //  1    4   Talk to hotspot
      Display ("What if it answers back, better not.");
      }
      else if (type==7) {  //  1    7   Pick up hotspot
      }
      else if (type==8) {  //  1    8   Cursor Mode 8 on hotspot
      }
      else if (type==9) {  //  1    9   Cursor Mode 9 on hotspot
      }
      else  {                     //  Undefined
      }
   }
     
   //  Unhandled Object
   else if (what== 2) {   
      //
      if (type==0) {         //  2    0   Look at object
         Display("It looks fine.");
      }
      else if (type==1) {  //  2    1   Interact with object
          Display ("You have more important things to worry about at the moment.");
      }
      else if (type==2) {  //  2    2   Talk to object
      }
      else if (type==3) {  //  2    3   Use inventory on object
      }
      else if (type==5) {  //  2    5   Pick up object
      }
      else if (type==6) {  //  2    6   Cursor Mode 8 on object
      }
      else if (type==7) {  //  2    7   Cursor Mode 9 on object
      }
      else  {                     //  Undefined
      }
   }

//[..]
//  Unhandled Character
   else if (what==3)  {   
   //
      if (type==0) {  //  3    0   Look at character (The error is on this line.)
      Display("A stranger, better not upset them.");
      }
      else if (type==1) {  //  3    1   Interact with character
      Display("Poking a stranger is likely to put you in a bad situation.");
      }
      else if (type==2) {  //  3    2   Speak to character
      Display("Perhaps you are not worth talking to.");
      }
      else if (type==3) {  //  3    3   Use inventory on character
      Display("You suspect that this is not the right thing to give away.");
      }
      else if (type==5) {  //  3    5   Pick up character
      }
      else if (type==6) {  //  3    6   Cursor Mode 8 on character
      }
      else if (type==7) {  //  3    7   Cursor Mode 9 on character
      }
      else  {                     //  Undefined
      }
   }
   // Unhandled Nothing
   else if (what==4) {
      if (type==1) {          //  4    1   Look at nothing (ie. no hotspot)
      }
      else if (type==2) {  //  4    2   Interact with nothing
      }
      else if (type==3) {  //  4    3   Use inventory with nothing
      }
      else if (type==4) {  //  4    4   Talk to nothing
      }
      else  {                     //  Undefined
      }     
   }
     
   // Unhandled Inventory
   else if (what==5) {
       if (type==0) {       //  5    0   Look at inventory
      }
      else if (type==1) {  //  5    1   Interact with inventory (currently not possible)
      }
      else if (type==2) {  //  5    2   Speak to inventory
      }
      else if (type==3) {  //  5    3   Use an inventory item on another
      }
      else if (type==4) {  //  5    4   Other click on inventory
      }
      else  {                     //  Undefined
      }     
   }

  // Unhandled Undefined
   else {
      // This isn't supposed to happen
   }
}


function cDroid_Look()
{
Display("The droid is made to look human in order to set people at ease. Of course, the fact that it looks like a buff bodybuilder clad in gold might just be an artistic liberty.");
Display("This one is the female model XX-639");
}

function cDroid_Interact()
{
cEgo.Walk(100, 175, eBlock, eWalkableAreas);
cEgo.Say("Sure, I will just attempt to overpower a droid that could crush my skull without any effort....");
}

function iBlueCup_Look()
{
Display("It is your access card; it grants you access to most of the ship");
}



function LBnews_OnSelectionChanged(GUIControl *control)
{
   if (LBnews.SelectedIndex == 0)
  { 
  LBnews.Visible = false;
  Lnews1.Visible = true;
  Wait(240);
   LBnews.Visible = true;
  Lnews1.Visible = false;
  }
  if (LBnews.SelectedIndex == 1)
  {Display("You have no mail");
  }
}






function TNews_OnActivate(GUIControl *control)
{
if (TNews.Text == "News")
{
LBnews.Visible = false;
  Lnews1.Visible = true;
comp1 = 2;
  TNews.Text = "";}
  else if (TNews.Text == "Mail")
  {
  Display("You have no mail");
   TNews.Text = "";}
   else if (TNews.Text == "Maintenance")
  {
  gComputer.Visible = false;
  gPasswordM.Visible = true;
   TNews.Text = "";}
   else if (TNews.Text == "Tasks")
  {LBnews.Visible = false;
  LTasks.Visible = true;
  task = 1;
  comp1 =1;
  TNews.Text = "";}
    else if (TNews.Text == "Quit")
  {
    gInventory.Visible = true;
  gComputer.Visible = false;
  TNews.Text = "";}
  else  if (comp1 == 1)
  {LBnews.Visible = true;
  LTasks.Visible = false;
  }
    else  if (comp1 == 2)
  {LBnews.Visible = true;
  Lnews1.Visible = false;
  }
  else
  {Display ("You cannot just type nonsense in here and expect it to work");
  }
}

function iComputer_Look()
{
  gInventory.Visible = false;
gComputer.Visible = true;
}

function TpasswordM_OnActivate(GUIControl *control)
{
if (TpasswordM.Text == "ABORT")
{gComputer.Visible = true;
  gPasswordM.Visible = false;
   TNews.Text = "";
   TpasswordM.Text = "";}
   else
   {
     Display("YOU FUCKED UP!");
     QuitGame(0);   
}
}
function cDroid_Talk()
{
if (task == 1)
{
    dialog[0].SetOptionState(3, eOptionOn);
}
else
{dialog[3].SetOptionState(3, eOptionOff);
}
cEgo.Walk(100, 175, eBlock, eWalkableAreas);
dDroid1.Start();
}

function ODrill_Look()
{
cEgo.Say("Hey, have you ever needed an adaptable tool that will extract just about anything !?");
cEgo.Say("Then you need the Cliffy Drilldozer ! With its adaptive tip, it penetrates!");
cEgo.Say("And unlike Hitlers dad, it always pulls out.");
cEgo.Say("Man that commercial was everywhere.");
}

function cFat_Talk()
{
  if (stucklocker1 == 1)
{
    dialog[4].SetOptionState(5, eOptionOn);
}
  cEgo.Walk(32, 150, eBlock, eWalkableAreas);
  cEgo.FaceCharacter(cFat);
  cFat.FaceCharacter(cEgo);
dFat.Start();
}

function cFat_Look()
{
Display("With a BMI of 50, Johan is the kind of employee Kamashisoft is lucky to have. He claims it is all muscle."); 
Display("The kind of muscle that makes you out of breath after getting out of bed in the morning.");
}

function cFat_Interact()
{
Display("While he might be as athletic as Zimbabwean dollars are a real currency. He is still about eight times as heavy as you are.");
}

function iWires_Look()
{
Display("Wires marked with TK421");
}

function cDroid_UseInv()
{
cEgo.Walk(100, 175, eBlock, eWalkableAreas);
  cEgo.FaceDirection(eDirectionLeft);
if (cEgo.ActiveInventory == iComputer)
{ cEgo.Say("I need a connecting wire, and the maintenance program running first.");
}
else if (cEgo.ActiveInventory == iComputerwire)
{cEgo.Say("All right, let's see what's wrong with you");
gDroidMaintenance.Visible =true;
  mouse.EnableMode(eModePointer);
  gIconbar.Visible = false;
  AudioChannel* chan1 = aThe_Entertainer.Play();
  chan1.Volume = 20;
}
else
{cEgo.Say("I don't think that's gonna work.");
}
}






function cCantine_Look()
{
Display("Gladys, the enigmatic server of frozen dinosaur nuggets.");
}

function cCantine_Interact()
{
Display("Gladys is wise enough to hide behind the thick glass of the cantina, you cannot reach her.");
}

function cCantine_Talk()
{
  cEgo.Walk(485, 169);
  cEgo.FaceCharacter(cCantine);
dVendor.Start();
}

function iComputer_UseInv()
{
if (cEgo.ActiveInventory == ODrill)
{
Display("Undoing your personal computer would be very unwise. As this would leave you with no way of interacting with the ship.");
}
else if (cEgo.ActiveInventory == iBlueCup)
{Display("You plug your access card into the computer");
Wait(20);
Display("It currently grants you access to Level 1 Doors, and the staff bathroom.");
}
else if (cEgo.ActiveInventory == iComputer)
{Display("I do not know how you managed to make this item interact with itself, but bravo you 1337 haxxor.");
}
else if (cEgo.ActiveInventory == iWires)
{Display("You neatly plug the exposed wires into your computer, the fizzing and sparks are probably a good sign.");
player.AddInventory(iComputerwire);
player.LoseInventory(iComputer);
player.LoseInventory(iWires);
}
}

function iComputerwire_Look()
{
  gInventory.Visible = false;
gComputer.Visible = true;
}



function TBdroid_OnActivate(GUIControl *control)
{
if (TBdroid.Text == "Defragment")
{
Display("You start the defragmentation process");
Wait(60);
Display("This might take a while");
TBdroid.Text = "";}
  else if (TBdroid.Text == "Debug")
  {
  Display("There are no bugs crawling on this droid.");
   TBdroid.Text = "";}
   else if (TBdroid.Text == "System")
  {
    gDroidoverview.Visible = true;
gDroidMaintenance.Visible = false;
  TBdroid.Text = "";}
   else if (TBdroid.Text == "Tasks")
  {LBnews.Visible = false;
  LTasks.Visible = true;
  task = 1;
  comp1 =1;
  TBdroid.Text = "";
  TNews.Text = "";}
    else if (TBdroid.Text == "Back")
  {
  gComputer.Visible = true;
  gDroidMaintenance.Visible = false;
  TNews.Text = "";}
  else if (TBdroid.Text == "Personality")
  {Display("It would appear you do not have access to change the personality of the robot, however you can check the listings of possible personalities.");
  Display("They are as follows");
  Display("Guard.bat");
  Display("Merchant.bat");
  Display("Engineer.bat");
  Display("Sexy_schoolgirl_xoxo.bat.exe");
  TBdroid.Text = "";
  }
  else
  {Display ("You cannot just type nonsense in here and expect it to work, remember this is case sensitive ?");
  }
}

function Button1_OnClick(GUIControl *control, MouseButton button)
{
gDroidoverview.Visible = false;
aCold_Sober.Play();
gIconbar.Visible = true;
}

function iBlast_Look()
{
Display("Protein Blast® is the new and upcumming energy drink for the person on the go. It will give you the right amount jizz when you crave it.");
}



function Tinfo_OnActivate(GUIControl *control)
{
if (Tinfo.Text == "PASSWORD")
{cEgo.Say("Hmmm, too obvious, even for the admin");
Tinfo.Text = "";
}
else if (Tinfo.Text == "QUIT")
gPasswordsoda.Visible = false;
else
{Tinfo.Text = "";
}
}

function cFat_UseInv()
{
if (cEgo.ActiveInventory == iBlast)
{
  cEgo.Walk(32, 150, eBlock, eWalkableAreas);
  cEgo.FaceCharacter(cFat);
  cFat.FaceCharacter(cEgo);
  if(stucklocker1 == 3)
  {cEgo.Say("Please accept this peace offering, I know you are all muscle, I was just jealous cause of my spindly noodly arms, have this 120 grams of pure protein.");
  cEgo.Say("You need it to maintain your peak physique");
  cFat.Say("Seee, that wasn't so hard was it, I forgive you, I know it can't be easy being a little stick insect no man in their right mind would want.");
  Wait(60);
  cEgo.Say("Yeeeeah... now about opening that locker ?");
  cFat.Say("What ? Oh yeah, but as you said,a strong man needs fuel, soo ehm, if you wouldn't mind getting me something to eat too ?");
  Wait(60);
  cEgo.Say("Of course I wouldn't, cause I need those spare parts, and I wont let my girly emotions run away with me again, will I ?");
  cFat.Say("That's the spirt, now ehm, I want something with a lot of taste.");
  cFat.Say("But no greens, dad told me never to eat anything that had gone green. Cept for pistachio ice cream");
  cFat.Say("I need it to be dense in calories, no diet food. This dream bod does not just maintain itself you know");
  cFat.Say("Nothing fancy. Nothing oriental. Nothing spicy,  and NO,  I repeat NO artificial sugars.");
  cFat.Say("Got that ?");
  cEgo.Say("Why yes, I believe I do, I will just repeat it to myself once more.");
  cEgo.Say("Great taste, no greens, dense calories, nothing fancy,nothing asian,nothing spicy,no fake sugars, yeah ?");
  cFat.Say("You ought to write that down");
  stucklocker1 = 4;
  player.LoseInventory(iBlast);
  }
  else if(stucklocker1 == 2)
  {cEgo.Say("The machine was all out of sugar rush, but hey, I got you this protein blast. 120 grams of protein, and 400 grams of sugar in one little can.");
  cFat.Say("I will accept this meager offering, thanks Red.");
  Wait(60);
  cEgo.Say("Yeeeeah... now about opening that locker ?");
  cFat.Say("What ? Oh yeah, but as you said,a strong man needs fuel, soo ehm, if you wouldn't mind getting me something to eat too ?");
  Wait(60);
  cEgo.Say("Come on, I got you the damn drink.");
  cFat.Say("Beggars cant be choosers now can they ? Now ehm, I want something with a lot of taste.");
  cFat.Say("But no greens, dad told me never to eat anything that had gone green. Cept for pistachio ice cream");
  cFat.Say("I need it to be dense in calories, no diet food. This dream bod does not just maintain itself you know");
  cFat.Say("Nothing fancy. Nothing oriental. Nothing spicy,  and NO,  I repeat NO artificial sugars.");
  cFat.Say("Got that ?");
  cEgo.Say("Why yes, I believe I do, I will just repeat it to myself once more.");
  cEgo.Say("Great taste, no greens, dense calories, nothing fancy,nothing asian,nothing spicy,no fake sugars, yeah ?");
  cFat.Say("You ought to write that down");
  stucklocker1 = 4;
  player.LoseInventory(iBlast);
  }
  else 
  {cEgo.Say("No way, why should I give him my protein");
  }
}
if (cEgo.ActiveInventory ==iFood)
{
cEgo.Walk(32, 150, eBlock, eWalkableAreas);
  cEgo.FaceCharacter(cFat);
  cFat.FaceCharacter(cEgo);
{if (canFood == 1)
{cFat.Say("Hey Reddy, I know it's hard to keep up, but I like ordered something with great taste. Not to insult your tastebuds, but this tastes like a pair of pants after the hundred years war.");
}
else if (canFood == 2)
{cFat.Say("Like I was very specific wasn't I ? NO GREENS!");
cEgo.Say("Oh come on, there is hardly anything green there, this is a dryfreeze product.");
cFat.Say("I shall pretend I did not hear you. Now go get me some proper food.");
}
else if (canFood == 4)
{cFat.Say("Ah, la bleu bleu bleu, I said nothing fancy ! Jeez, how difficult can it be.");
}
else if (canFood == 5)
{cFat.Say("No offense to you or your race Reddy, but oriental food just doesn't sit right in my gut.");
cEgo.Say("I see, I shall have to remember that. ASIAN food disagrees with you.");
}
else if (canFood == 6)
{cFat.Say("Oh nononono, if I ate this my pucker would be the burning ring of fire. No spicy food thanks.");
}
else if (canFood == 7)
{cFat.Say("Okay, I appreciate that a stick insect like yourself has trouble understanding this, but not all of us are on diets, and I require no artificial  sweeteners, they are sooo bad for you.");
}
else if (canFood == 99)
{cFat.Say("Hey awesome, that looks like just what I asked for... except...");
Wait(30);
cEgo.Say("Except what ? WHAT COULD POSSIBLY BE WRONG WITH THIS !?");
Wait(20);
cFat.Say("Don't shout, you're gonna give me a headache. Well It isn't cooked. You need to add boiling water to it, and serve it on a plate, right ?");
Wait(30);
cEgo.Say("Riiiight, how thoughtless of me, just you stand here doing nothing, while I go prepare your meal for you.");
}
}
}
}

function bRamen_OnClick(GUIControl *control, MouseButton button)
{
  Display("RAMEN");
  lCheese.Visible = false;
  lStroganoff.Visible = false;
lRamen.Visible = true;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 5;
}

function bStrog_OnClick(GUIControl *control, MouseButton button)
{
Display("CHICKEN STROGANOFF");
lCheese.Visible = false;
lStroganoff.Visible = true;
lRamen.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 4;
}

function bCheese_OnClick(GUIControl *control, MouseButton button)
{
Display("CHEESEBURGER");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = true;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 2;
}

function bRoganjosh_OnClick(GUIControl *control, MouseButton button)
{
Display("ROGAN JOSH");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = true;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 5;
}

function bTikka_OnClick(GUIControl *control, MouseButton button)
{
  Display("CHICKEN TIKKA MASALA");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = true;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 6;
}

function bSweden_OnClick(GUIControl *control, MouseButton button)
{
Display("SURSTROMMING");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = true;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 1;
}

function bBeef_OnClick(GUIControl *control, MouseButton button)
{
Display("BEEF BOURGUIGNON");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = true;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 4;
}

function bShepherd_OnClick(GUIControl *control, MouseButton button)
{
Display("SHEPHERD'S PIE");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = true;
lPizza.Visible = false;
lPancakes.Visible = false;
canFood = 99;
}

function bPizza_OnClick(GUIControl *control, MouseButton button)
{
Display("ITALIAN PIZZA");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = true;
lPancakes.Visible = false;
canFood = 2;
}

function bPancakes_OnClick(GUIControl *control, MouseButton button)
{
Display("PROTEIN PANCAKES");
lStroganoff.Visible = false;
lRamen.Visible = false;
lCheese.Visible = false;
lRoganjosh.Visible = false;
lTikka.Visible = false;
lSweden.Visible = false;
lBeef.Visible = false;
lShepherd.Visible = false;
lPizza.Visible = false;
lPancakes.Visible = true;
canFood = 7;
}

function bConfirm_OnClick(GUIControl *control, MouseButton button)
{
  gIconbar.Visible = true;
Display("ALL RIGHT, YOUR ORDER IS CONFIRMED. GATHER YOUR MEAL AT THE VENDING MACHINE. ENJOY !");
AudioChannel* chan1 = aCantina_Blues.Play();
  chan1.Volume = 20;
gMenu.Visible = false;
}

function iFood_Look()
{
Display("Amazing to think how you could get something so nutritious into such a small can.");
}

function cEgo_UseInv()
{
if (cEgo.ActiveInventory == iwaterskin)
{Display ("It's empty John, there is no water in it.");
}
if (cEgo.ActiveInventory == iwaterskinnfull)
{Display ("It might be prudent to wait til you really need the water");
}
if (cEgo.ActiveInventory == iKey)
{Display ("You decide against slitting your wrists, there is always hope after all");
}
if (cEgo.ActiveInventory == iComputerwire)
{Display("You remove the wires from your personal computer.");
player.AddInventory(iComputer);
player.AddInventory(iWires);
player.LoseInventory(iComputerwire);
}
else
{Display ("I am not sure I want to know how you plan to use that on yourself. You weirdo.");
}
}

function cCleaner_Talk()
{
cEgo.Say("I sincerely doubt this thing understands me");
}

function cCleaner_Interact()
{
cEgo.Say("No way, these things are vicious, I wouldn't try it unless it was dead");
}

function cCleaner_Look()
{
cEgo.Say("The DOOMBA 5000 (tm), a service droid doing maintenance on the floors.");
}

function cSkull_Talk()
{
  cEgo.FaceCharacter(cSkull);
cEgo.Say("I shouldn't, the Skull probably outranks me.");
}

function cSkull_Interact()
{
  cEgo.FaceCharacter(cSkull);
cEgo.Say("I can't reach it, besides the clergy might see me messing with it.");
}

function CMechanicus_Look()
{
  cEgo.FaceCharacter(CMechanicus);
  Display("The Adeptus Mechanicus, the fabled mechlords of Mars. Cross them, and you might find your re-breather failing on an important mission.");
}

function CMechanicus_Interact()
{
  cEgo.FaceCharacter(CMechanicus);
  Display("The Adeptus Mechanicus would overpower you in an instant, and rend your flesh to festive ribbons. Better not atempt it.");
}

function CMechanicus_Talk()
{
cEgo.Walk(203, 190, eBlock, eWalkableAreas);
cEgo.FaceCharacter(CMechanicus);
cEgo.Say("Excuse me Sir.");
CMechanicus.Say("Cease your prattling meatbag, can you not see I am atempting to mend the broken machinespirit of this once mighty warrior, that they may rise again and crush our enemies !?");
}

function iWrecker_Look()
{
Display("The Wrecker is a true multipurpose opening tool. Use it to open doors, machines or even people.");
}

function cTyler1_Talk()
{cEgo.Walk(343, 370, eBlock, eWalkableAreas);
cEgo.FaceCharacter(cTyler1);
dTyler.Start();
}

function cTyler1_Look()
{
cEgo.Walk(343, 370, eBlock, eWalkableAreas);
Display("Tyler, thinks he knows what every woman wants, and it is himself.");
}

function cTyler1_Interact()
{
cEgo.Walk(343, 370, eBlock, eWalkableAreas);
cEgo.Say("He's not my type");
cTyler1.Say("Hehe, your type is the sort that runs on batteries and goes bzz-bzz.");
}

function cBrah_Look()
{
cEgo.Walk(349, 489, eBlock, eWalkableAreas);
cEgo.FaceCharacter(cBrah);
cEgo.Say("Now that is one huge lady");
cBrah.Say("Grrrrr");
}

function cBrah_Interact()
{
cEgo.Walk(349, 489, eBlock, eWalkableAreas);
cEgo.FaceCharacter(cBrah);
cEgo.Say("Yeah, I aint about to atempt to physically overcome this beast.");
cBrah.Say("Grrrrr");
}

function cBrah_Talk()
{
cEgo.Walk(349, 489, eBlock, eWalkableAreas);
cEgo.FaceCharacter(cBrah);
dBruh.Start();
}

function cfatdave_Interact()
{
cEgo.Walk(510, 380, eNoBlock, eWalkableAreas);
cEgo.FaceCharacter(cfatdave);
Display("Now why would you want to punch Dave in the face, he's a nice bloke, honest.");
}

function cfatdave_Look()
{
cEgo.Walk(510, 380, eNoBlock, eWalkableAreas);
cEgo.FaceCharacter(cfatdave);
Display("Dave the Engineer");
}

function cfatdave_Talk()
{
cEgo.Walk(510, 380, eNoBlock, eWalkableAreas);
cEgo.FaceCharacter(cfatdave);
cEgo.Say("Hello Dave");
Wait(50);
cEgo.Say("Okay bye");
}

function bSkipyes_OnClick(GUIControl *control, MouseButton button)
{
  gSkip.Visible = false;
cEgo.ChangeRoom(22);
}

function Bskipno_OnClick(GUIControl *control, MouseButton button)
{
  gSkip.Visible = false;
cEgo.ChangeRoom(21);
}

function CMechanicus_UseInv()
{
cEgo.FaceCharacter(CMechanicus);
  Display("Better not give stuff away to them, they might decide to keep it.");
}

function cSkull_Look()
{

}
